<!doctype html><html lang=en-us><!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content="Fabien Péan"><meta name=google-site-verification content="_OCqKj2I4fVqJsqpa9uq0utQ55W1kx93lTIQtHZ88mM"><link rel="shortcut icon" type=image/png href=/img/logo.svg><title>Fabien Péan &#183; Personal Website</title><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><link rel=stylesheet type=text/css href=/css/normalize.css><link rel=stylesheet href=/vendor/colors/css/colors.min.css><link rel=stylesheet href=/vendor/academicons/css/academicons.min.css><style>:root{--font-monospace:"Source Code Pro";--font-sans-serif:"Inter"}</style><link href="https://fonts.googleapis.com/css?family=Inter%7cSource+Code+Pro&display=swap" rel=stylesheet type=text/css><link rel=stylesheet href=/css/custom.css></head><body><body><nav id=nav><figure id=logo class=image><img src=/img/logo.svg></figure><div id=branding><div class=branding-title>Fabien Péan</div><div class=branding-subtitle></div></div><div id=menu><a class=menu-link href=/><div class=menu-item><span class=menu-label><i class="fas fa-home fa-fw"></i>&nbsp;Home</span></div></a><a class=menu-link href=/news><div class=menu-item><span class=menu-label><i class="fas fa-newspaper fa-fw"></i>&nbsp;News</span></div></a><a class=menu-link href=/blog><div class=menu-item><span class=menu-label><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;Blog</span></div></a><a class=menu-link href=/notes><div class=menu-item><span class=menu-label><i class="fas fa-sticky-note fa-fw"></i>&nbsp;Notes</span></div></a><a class=menu-link href=/projects><div class=menu-item><span class=menu-label><i class="fas fa-book fa-fw"></i>&nbsp;Projects</span></div></a></div><div class=social><div class=social-list><div style="display:flex;flex-flow:row wrap;justify-content:center"><div class="social-button email"><a href=mailto:fabien@pean.pro rel=author><i class="fas fa-at fa-2x"></i></a></div><div class="social-button bitbucket"><a href=https://bitbucket.org/FabienPean rel="author external"><i class="fab fa-bitbucket fa-2x"></i></a></div><div class="social-button github"><a href=https://github.com/FabienPean rel="author external"><i class="fab fa-github fa-2x"></i></a></div><div class="social-button linkedin"><a href=https://www.linkedin.com/in/FabienPean rel="author external"><i class="fab fa-linkedin fa-2x"></i></a></div></div></div></div></nav><main id=main><div class=content><h1>Missing concept: the quest for <code>range_of</code></h1><small><div class=subtitle style="display:flex;flex-flow:row wrap;justify-content:space-between"><span style="flex:1 0 auto;max-width:100%"><span class=tooltip>28/02/2025
<span class=tooltiptext><small>updated on 03/03/2025</small></span>
</span>&nbsp;&boxv;&nbsp;<a href=/blog>Blog</a></span><div class=tag-list><a href=/tags/c++><div class=tag>c++</div></a><a href=/tags/c++20><div class=tag>c++20</div></a></div></div></small><br><h2 id=reeling-back-a-bit>Reeling back a bit</h2><h3 id=what-is-a-range>What is a range?</h3><p>Let us have a look into the <a href=https://timsong-cpp.github.io/cppwp/n4868/range.range>C++20 standard</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span> <span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>requires</span>( T<span style=color:#ff79c6>&amp;</span> t ) {
</span></span><span style=display:flex><span>    ranges<span style=color:#ff79c6>::</span>begin(t); <span style=color:#6272a4>// equality-preserving for forward iterators
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    ranges<span style=color:#ff79c6>::</span>end (t);
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>A range is a C++ concept, a set of constraint, that must be fulfilled for a type to be called <em>range</em>. As per the definition above, any type T that provides valid definition for the calls to <code>ranges::begin</code> and <code>ranges::end</code>. Following decades of usage in the STL, well known (maybe dreaded) by C++ developers, a range consists in a pair of iterators returned by begin and end. Why those two instead of the existing <code>std::begin</code>and <code>std::end</code> ? Simply to enable more customization. Remember that except in some rare case (looking at you <code>std::hash</code>), thou shall not add, specialize, or overload anything in the <code>std::</code> namespace ! A range can be satisfied by either providing member functions <code>.begin()</code> and <code>.end()</code> or via call to free functions <code>begin()</code> and <code>end()</code> that can be found via <a href=https://en.cppreference.com/w/cpp/language/adl>Argument Dependent Lookup</a>.</p><h3 id=a-range-for-what->A range for what ?</h3><p>The principle behind ranges is to compose algorithms over data that can be iterated over in a more expressive, declarative, and concise way. Do you remember the good old algorithms header: <code>std::accumulate</code>, <code>std::transform</code>? Yes, me too, and I still wince thinking about it.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>unary_transform_example</span>(std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>&amp;</span> hello, std<span style=color:#ff79c6>::</span>string world)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Transform string to uppercase in-place
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>transform(hello.cbegin(), hello.cend(), hello.begin(), [](<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> c){<span style=color:#ff79c6>return</span> std<span style=color:#ff79c6>::</span>toupper(c);});
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;hello = &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> std<span style=color:#ff79c6>::</span>quoted(hello) <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#39;\n&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// for_each version (see Notes above)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>for_each(world.begin(), world.end(), [](<span style=color:#8be9fd>char</span><span style=color:#ff79c6>&amp;</span> c){c <span style=color:#ff79c6>=</span> to_uppercase(c);});
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;world = &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> std<span style=color:#ff79c6>::</span>quoted(world) <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#39;\n&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Sorry for the jump scare, I know many of us have rough trauma typing all those begin/end all over the place 😄</p><p>An example to illustrate ranges could be</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>auto</span> source <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>vector{<span style=color:#ff79c6>-</span><span style=color:#bd93f9>2</span>,<span style=color:#bd93f9>3</span>,<span style=color:#bd93f9>0</span>,<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5</span>};
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> composition <span style=color:#ff79c6>=</span> source <span style=color:#ff79c6>|</span> std<span style=color:#ff79c6>::</span>views<span style=color:#ff79c6>::</span>filter([](<span style=color:#ff79c6>auto</span> x){<span style=color:#ff79c6>return</span> x <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span>;}) 
</span></span><span style=display:flex><span>                          <span style=color:#ff79c6>|</span> std<span style=color:#ff79c6>::</span>views<span style=color:#ff79c6>::</span>transform([](<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;</span> x){<span style=color:#ff79c6>return</span> x<span style=color:#ff79c6>*</span><span style=color:#bd93f9>2</span>;});
</span></span><span style=display:flex><span>std<span style=color:#ff79c6>::</span>println(<span style=color:#f1fa8c>&#34;{}&#34;</span>,composition);
</span></span></code></pre></td></tr></table></div></div><p>The footprint is smaller and the intent is clearer, don&rsquo;t you think so ? Moreover, it is not possible to compose regular algorithms because they are eager, and act directly on the input, which means <code>filter</code> would need to be implement as a for loop.</p><p>Alright, some may argue that lambdas are the new clutter, and I cannot really disagree with that, they do take a lot of visual space, as opposed to similar tools in other languages, e.g. Java, seen the extensive list given <a href=https://brevzin.github.io/c++/2020/06/18/lambda-lambda-lambda/>here</a>. One can always go with <a href=https://www.boost.org/doc/libs/1_86_0/doc/html/lambda/le_in_details.html#lambda.placeholders>Boost.Lambda</a> or <a href=https://vector-of-bool.github.io/2021/04/20/terse-lambda-macro.html>hardcore macros</a>. Unfortunately, it is not easy, like everything in C++ dare I say, to get short lambda in the Core language due to every possibilities that must be considered, discussed, and approved.</p><h3 id=what-with-a-range->What with a range ?</h3><p>Thanks to the ranges library, one can easily restrict template functions to perform an operation on a sequence of elements. Let us consider briefly this slightly contrived example:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>namespace</span> my_views
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> cos(R<span style=color:#ff79c6>&amp;&amp;</span> range)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> std<span style=color:#ff79c6>::</span>views<span style=color:#ff79c6>::</span>transform(r,[](<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> x){<span style=color:#ff79c6>return</span> std<span style=color:#ff79c6>::</span>cos(x);})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Great isn&rsquo;t it ? &mldr;or is it ? Yes we constrained the template from an <em>infinite</em> amount of possibilities, but to an <em>infinite</em> subset of possibilities. A simple range requirement is not sufficient to constrain meaningfully the function to our goal. Therefore, we would need to add further <code>requires</code> clauses, <code>static_assert</code>, or other techniques, cluttering the declaration and/or definition to harden it properly. Although, in the end, what we wish for is simply a range of floating point values.</p><h2 id=getting-to-the-point>Getting to the point</h2><p>Now that the context is set, let us get back to the main topic of this post, and express how we wish we could write <em>&ldquo;a range of integers&rdquo;</em>. Like a wise man said <a href="https://www.youtube.com/watch?v=lPfA4SFojao">&ldquo;Design your abstractions from what you would like to type !&rdquo;</a> (Vincent Reverdy, at his talk from CppCon2023), which is a principle I strongly adhere.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// Like this 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>foo</span>(range_of<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;&amp;</span> r); <span style=color:#6272a4>// inline
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// or with explicit template parameter list
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>range_of<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> foo(R<span style=color:#ff79c6>&amp;&amp;</span> r);
</span></span></code></pre></td></tr></table></div></div><p>To make it work currently with standard library facilities (in C++20 and above), one would need to resort to the following</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span>,<span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> foo(R<span style=color:#ff79c6>&amp;&amp;</span> r)
</span></span></code></pre></td></tr></table></div></div><p>It works, it is verbose, and it needs to be done at <em>every</em> function where you wish to accept a range of something.</p><h2 id=the-direct-path>The direct path</h2><p>The naïve way to go at it is to simply wrap the above snippet into a concept.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>typename</span> U<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&amp;&amp;</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>U,std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&gt;</span>;
</span></span></code></pre></td></tr></table></div></div><p>The magic of the standard allows us to use concepts as simply as this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>range_of<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> foo(R<span style=color:#ff79c6>&amp;&amp;</span> r) {}
</span></span></code></pre></td></tr></table></div></div><p>Because the argument R is automagically injected as the first argument of the constraint (<em>type-constraint</em> in the standard linguo), so that the compiler effectively checks: <code>range_of&lt;R,int></code></p><blockquote><p>Concepts can also be named in a type-constraint, as part of</p><ul><li><a href=https://en.cppreference.com/w/cpp/language/template_parameters#Type_template_parameter>type template parameter declaration</a>,</li><li><a href=https://en.cppreference.com/w/cpp/language/auto>placeholder type specifier</a>,</li><li><a href=https://en.cppreference.com/w/cpp/language/requires#Compound_Requirements>compound requirement</a>.</li></ul><p>In a <em>type-constraint</em>, a concept takes one less template argument than its parameter list demands, because the contextually deduced type is implicitly used as the first argument of the concept.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span>, <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>U</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> Derived <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>is_base_of<span style=color:#ff79c6>&lt;</span>U, T<span style=color:#ff79c6>&gt;::</span>value;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span> Derived<span style=color:#ff79c6>&lt;</span>Base<span style=color:#ff79c6>&gt;</span> T <span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> f(T); <span style=color:#6272a4>// T is constrained by Derived&lt;T, Base&gt;
</span></span></span></code></pre></td></tr></table></div></div></blockquote><p>The exact wording can be checked in the released C++20 standard document, or more conveniently (and freely) in the <a href=https://eel.is/c++draft/temp.param#4>working draft</a></p><h2 id=limitations>Limitations</h2><h3 id=l-minor-musical_note>L minor 🎵</h3><p>What if we want to query something else than the range value type, but the range reference type, like explained <a href=https://stackoverflow.com/a/64228354/4709428>here</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>typename</span> V<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> and std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>V,std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_reference_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span>;
</span></span></code></pre></td></tr></table></div></div><p>One can get away with this problem relatively simply by adding the argument in the template argument list, at the cost of a slightly heavier interface.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>typename</span> V, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> and std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span> V, E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;</span>;
</span></span></code></pre></td></tr></table></div></div><h3 id=l-major-notes>L major 🎶</h3><p>The other issue is much hairier, what if instead of a range of just integers, we want to accept a range of <em>integral</em> types ? Suddenly our concrete type is abstracted away and must satisfy a generic constraint ! We would like to be able to write:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>range_of<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> foo(R<span style=color:#ff79c6>&amp;&amp;</span> r) {}
</span></span></code></pre></td></tr></table></div></div><p>Which would translate into</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>concept</span> V, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> and std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span> V<span style=color:#ff79c6>&lt;</span>E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span> , E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;</span>;
</span></span></code></pre></td></tr></table></div></div><p>Can your compiler do it ? At least not at the time of release of this post ! Still living in C++23 or below here, my sweet reader from the future with cutting edge compilers.</p><h2 id=the-standard-will-save-us-all>The standard will save us all&mldr;</h2><p>Hopefully, some brave souls are heralding the fight for change with proposal <a href=https://wg21.link/p2841r7>P2841</a> <del>aimed to land</del> landing in C++26. It would enable concept argument in the template argument list.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>concept</span> C<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> decays_to <span style=color:#ff79c6>=</span> C<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>decay_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&gt;</span>;
</span></span></code></pre></td></tr></table></div></div><p>Until it reaches us mere common developer, the proposal provides a <a href=https://p2841.godbolt.org/z/efYK1crb3>compiler explorer link</a> listing exhaustively possible workarounds to pass constraints concepts around, from least palatable but more efficient via lambda tricks, to inefficient but user friendly via type indirection.</p><h2 id=or-not>&mldr;or not</h2><p>Unfortunately, the proposal does not solve a second major issue at hand: what if we want to use our concept with a direct type?</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// For the given definition of the concept `range_of`
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>concept</span> V, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> and std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span> V<span style=color:#ff79c6>&lt;</span>E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span> , E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>range_of<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>  <span style=color:#6272a4>// ✅ passing a concept to a concept argument
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> foo(R<span style=color:#ff79c6>&amp;&amp;</span> r) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>range_of<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span> 			<span style=color:#6272a4>// ❌ passing a typename to a concept argument
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> bar(R<span style=color:#ff79c6>&amp;&amp;</span> r) {}
</span></span></code></pre></td></tr></table></div></div><p>The standard does not do not allow redefinition of concepts, and template arguments will have to be either a concept or a type, precluding the other from existing. Stalemate ! Maybe this will all be resolved with <a href=https://wg21.link/P2989>Universal Template Parameters</a>, a proposal for unifying template parameters (type, variable, concepts) into a single representation ?</p><h2 id=everything-can-be-solved-with-yet-another-layer-of-indirection>Everything can be solved with (yet) another layer of indirection</h2><p>Let us dig the idiom 4 from the list of alternatives above as a starting point.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// Idiom 4: Use a metafunction class convention
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>namespace</span> mfc_idiom {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>namespace</span> mfc {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Copyable</span> {
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>apply</span> <span style=color:#ff79c6>:</span> std<span style=color:#ff79c6>::</span>bool_constant<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>copyable<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&gt;</span> {};
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>	} <span style=color:#6272a4>// namespace mfc
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>class</span> /* &#34;<span style=color:#50fa7b>concept</span><span style=color:#f1fa8c>&#34; */ C&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>concept</span> decays_to <span style=color:#ff79c6>=</span> C<span style=color:#ff79c6>::</span><span style=color:#ff79c6>template</span> apply<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>decay_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&gt;::</span>value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span>decays_to<span style=color:#ff79c6>&lt;</span>mfc<span style=color:#ff79c6>::</span>Copyable<span style=color:#ff79c6>&gt;</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> f(T<span style=color:#ff79c6>&amp;&amp;</span> x) {}
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>The idiom converts a concept down to a type, which can be passed around as template arguments more easily (thereby nullifying the benefits of <code>concept</code> as core language construct, but this is the topic for another day). Adapted to our situation, it becomes</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6272a4>// Library code
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>namespace</span> comcept<span style=color:#ff79c6>::</span>trt 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>integral</span> { <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>; };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> comcept
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>class</span> /* &#34;<span style=color:#50fa7b>concept</span><span style=color:#f1fa8c>&#34; */ C, template&lt;class...&gt; typename E = std::ranges::range_value_t&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span><span style=color:#8be9fd;font-style:italic>ranges</span>:range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&amp;&amp;</span> C<span style=color:#ff79c6>::</span><span style=color:#ff79c6>template</span> value<span style=color:#ff79c6>&lt;</span>E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#6272a4>// End-user example
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span>comcept<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span>comcept<span style=color:#ff79c6>::</span>trt<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> f(R<span style=color:#ff79c6>&amp;&amp;</span> x) {}
</span></span></code></pre></td></tr></table></div></div><p>It is a fine workaround, but it does not solve yet our previous issue of being able to pass either type or constraint. By resorting to logical short-circuiting, we can reach the desired result.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6272a4>// Library code
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>namespace</span> comcept<span style=color:#ff79c6>::</span>trait 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>integral</span> { <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>; };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> comcept
</span></span><span style=display:flex><span>{   
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>class</span> /* <span style=color:#50fa7b>type</span> or <span style=color:#f1fa8c>&#34;concept&#34;</span> */ C, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span>...<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span><span style=color:#8be9fd;font-style:italic>ranges</span>:range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&amp;&amp;</span> (std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>C, E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>||</span> C<span style=color:#ff79c6>::</span><span style=color:#ff79c6>template</span> value<span style=color:#ff79c6>&lt;</span>E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// End-user example
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span>comcept<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span>comcept<span style=color:#ff79c6>::</span>trait<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> f(R<span style=color:#ff79c6>&amp;&amp;</span> x) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span>comcept<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> f(R<span style=color:#ff79c6>&amp;&amp;</span> x) {}
</span></span></code></pre></td></tr></table></div></div><h2 id=generalization-for-binary-ternary-n-ary-constraints>Generalization for binary, ternary, n-ary constraints</h2><p>In the end, we convert concepts back into <a href=https://en.cppreference.com/w/cpp/header/type_traits>type traits</a>, where they themselves somewhat originate from, indeed type traits were used along with SFINAE to replicate to some extents constraint on templates. Type traits in C++ were introduced at a time where variable template were not part of the standard, hence the generic definition pooling all types within the outermost template argument list. For example, for <a href=https://en.cppreference.com/w/cpp/types/is_same><code>std::is_same</code></a></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span>, <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>U</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>is_same</span> <span style=color:#ff79c6>:</span> std<span style=color:#ff79c6>::</span>false_type {};
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>is_same</span><span style=color:#ff79c6>&lt;</span>T, T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>:</span> std<span style=color:#ff79c6>::</span>true_type {};
</span></span></code></pre></td></tr></table></div></div><p>All type traits were then given a direct boolean access thanks to the introduction of <a href=https://en.cppreference.com/w/cpp/language/variable_template>variable template</a>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>typename</span> U<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> is_same_v <span style=color:#ff79c6>=</span> is_same<span style=color:#ff79c6>&lt;</span>T, U<span style=color:#ff79c6>&gt;::</span>value;
</span></span></code></pre></td></tr></table></div></div><p>Those ways of defining type traits do not enable composition as all arguments must be known at instantiation point, which is not feasible during composition where the queried type is unknown until the last step. Yet, we can use the language feature to reformulate type traits into a two-phase look-up process, more suitable for our goal.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>U</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>is_same</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span>T,U<span style=color:#ff79c6>&gt;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>Now the queried type T is left unevaluated until requested, and we can carry the generic constraint as a concrete type. We can therefore create <code>is_same&lt;int></code> and check if any other type is actually similar to the curried requirement <code>is_base_of&lt;int>::value&lt;double></code> at the last moment. The principle is straightforwardly extended to concepts, and for any arity (ternay, n-ary).</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>U</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>same_as</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>T,U<span style=color:#ff79c6>&gt;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h2 id=range-of-span-stylefont-size75range-ofspan-span-stylefont-size50range-ofspan>Range of <span style=font-size:75%>range of</span> <span style=font-size:50%>range of</span></h2><p>Equipped with this new definition of type traits, we can create concepts which are compatible for composition, like <code>range_of</code>. Since concepts are not composable unto themselves, we just have to apply the same process of typification, type traitification (or whatever is the name), and convert that concept into a type, thereby enabling composable range of.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6272a4>// Library code
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>namespace</span> comcept<span style=color:#ff79c6>::</span>trait 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>integral</span> { <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>; };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> comcept
</span></span><span style=display:flex><span>{   
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> R, <span style=color:#ff79c6>class</span> /* <span style=color:#50fa7b>type</span> or <span style=color:#f1fa8c>&#34;concept&#34;</span> */ C, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span>...<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>concept</span> range_of <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span><span style=color:#8be9fd;font-style:italic>ranges</span>:range<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&amp;&amp;</span> (std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span>C, E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>||</span> C<span style=color:#ff79c6>::</span><span style=color:#ff79c6>template</span> value<span style=color:#ff79c6>&lt;</span>E<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;&gt;</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> comcept<span style=color:#ff79c6>::</span>trait 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> /* <span style=color:#50fa7b>type</span> or <span style=color:#f1fa8c>&#34;concept&#34;</span> */ C, <span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span>...<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>typename</span> E <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>range_of</span> { <span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>R</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>static</span> <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>bool</span> value <span style=color:#ff79c6>=</span> comcept<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span>R,C,E<span style=color:#ff79c6>&gt;</span>; };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// End-user example
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>namespace</span> ccpt <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>::</span>comcept;
</span></span><span style=display:flex><span><span style=color:#ff79c6>namespace</span> trt  <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>::</span>comcept<span style=color:#ff79c6>::</span>trait;
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span>ccpt<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span>trt<span style=color:#ff79c6>::</span>range_of<span style=color:#ff79c6>&lt;</span>trt<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&gt;&gt;</span> R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> f(R<span style=color:#ff79c6>&amp;&amp;</span> x) {}
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion</h2><p>In this post, we have seen how to build a friendly composable concept through the often desired <code>range_of</code> example. The solution was not about achieving top compilation speed, but instead, about developer-friendly API (well, at least, according to my taste). Nevertheless, handling type traits via dependent template variable reduces the amount of type instantiation, which might be easier for the compiler to generate, if variables are less costly to instantiate than types.</p><p>I wrapped up the outcome of this little exploration into a library named <a href=https://github.com/FabienPean/comcept><code>comcept</code></a>, the contraction of <em>composable concept</em>. The next steps would be enriching the library with more composable concepts, such as <code>tuple_of</code> and discuss about concept definition and limitations.</p></div></main><footer id=footer><div id=footer-inner>&copy;&nbsp;2020-2025&nbsp;&#183;&nbsp;Fabien Péan</div></footer><script>window.FontAwesomeConfig={searchPseudoElements:!0}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js integrity="sha512-6PM0qYu5KExuNcKt5bURAoT6KCThUmHRewN3zUFNaoI6Di7XJPTMoT6K0nsagZKk2OB4L7E3q1uQKHNHd4stIQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js integrity="sha512-yUUc0qWm2rhM7X0EFe82LNnv2moqArj5nro/w1bi05A09hRVeIZbN6jlMoyu0+4I/Bu4Ck/85JQIU82T82M28w==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.2/mermaid.min.js integrity="sha512-8ZrL1m0+KXHylxkFJdFtFCauQdV/KZMjSBL9iydsyIfiB1LwYBlGegX8dUlLnUtRDrTgWKP6pPVyOqa2VrqoNA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose",theme:"default",themeCSS:"",cloneCssStyles:!0,useMaxWidth:!0,htmlLabels:!1,flowchart:{curve:"basis"}})</script><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!1,processEnvironments:!0,tags:"ams"},svg:{fontCache:"global",displayAlign:"left",displayIndent:"2emem"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script src=/js/custom.js></script></body></html>