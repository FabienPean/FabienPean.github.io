<!doctype html><html lang=en-us><!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content="Fabien Péan"><meta name=google-site-verification content="_OCqKj2I4fVqJsqpa9uq0utQ55W1kx93lTIQtHZ88mM"><link rel="shortcut icon" type=image/png href=/img/logo.svg><title>Fabien Péan &#183; Personal Website</title><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><link rel=stylesheet type=text/css href=/css/normalize.css><link rel=stylesheet href=/vendor/colors/css/colors.min.css><link rel=stylesheet href=/vendor/academicons/css/academicons.min.css><style>:root{--font-monospace:"Source Code Pro";--font-sans-serif:"Inter"}</style><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css?family=Inter%7cSource+Code+Pro&display=swap" rel=stylesheet type=text/css><link rel=stylesheet href=/css/custom.css></head><body><body><nav id=nav><figure id=logo class=image><img src=/img/logo.svg></figure><div id=branding><div class=branding-title>Fabien Péan</div><div class=branding-subtitle></div></div><div id=menu><a class=menu-link href=/><div class=menu-item><span class=menu-label><i class="fas fa-home fa-fw"></i>&nbsp;Home</span></div></a><a class=menu-link href=/news><div class=menu-item><span class=menu-label><i class="fas fa-newspaper fa-fw"></i>&nbsp;News</span></div></a><a class=menu-link href=/blog><div class=menu-item><span class=menu-label><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;Blog</span></div></a><a class=menu-link href=/notes><div class=menu-item><span class=menu-label><i class="fas fa-sticky-note fa-fw"></i>&nbsp;Notes</span></div></a><a class=menu-link href=/projects><div class=menu-item><span class=menu-label><i class="fas fa-book fa-fw"></i>&nbsp;Projects</span></div></a></div><div class=social><div class=social-list><div style="display:flex;flex-flow:row wrap;justify-content:center"><div class="social-button email"><a href=mailto:fabien@pean.pro rel=author><i class="fas fa-at fa-2x"></i></a></div><div class="social-button bitbucket"><a href=https://bitbucket.org/FabienPean rel="author external"><i class="fab fa-bitbucket fa-2x"></i></a></div><div class="social-button github"><a href=https://github.com/FabienPean rel="author external"><i class="fab fa-github fa-2x"></i></a></div><div class="social-button linkedin"><a href=https://www.linkedin.com/in/FabienPean rel="author external"><i class="fab fa-linkedin fa-2x"></i></a></div></div></div></div></nav><main id=main><div class=content><h1>Crafting a versatile generic function using concepts and unexpected pitfalls of implicit ranges</h1><small><div class=subtitle style="display:flex;flex-flow:row wrap;justify-content:space-between"><span style="flex:1 0 auto;max-width:100%"><span class=tooltip>30/12/2024
<span class=tooltiptext><small>updated on 09/03/2025</small></span>
</span>&nbsp;&boxv;&nbsp;<a href=/blog>Blog</a></span><div class=tag-list><a href=/tags/c++><div class=tag>c++</div></a><a href=/tags/c++20><div class=tag>c++20</div></a></div></div></small><br><h2 id=context>Context</h2><p>During the course of my work, I was brought to develop a feature where the library user should be able upload a file or folder to a foreign storage. This post goes over my train of thought from a barebone function to a richer interface, covering some common use-cases. For the purpose of this post, <em>upload</em> will be reworded as <em>print</em>, where the argument is output to the console. A minor change, but relatively similar interface. The default prototype looks like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span>);
</span></span></code></pre></td></tr></table></div></div><p>The type is passed as a const reference because it is a heavy stateful object (until <a href=https://wg21.link/p1030>path_view</a> gets in) and I just want my function to bind the argument to either a L-value or R-value reference, without having to duplicate the function, or use template for the default case. Moreover, this choice enables to pass any object convertible to a path, including string.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// Usage
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path p;
</span></span><span style=display:flex><span>print(p);
</span></span><span style=display:flex><span>print(std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path{<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>});
</span></span><span style=display:flex><span>print(<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>);
</span></span></code></pre></td></tr></table></div></div><p>Later, I wanted to enrich my API by enabling users to upload a sequence of paths, for example</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// API extension example
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span> paths;
</span></span><span style=display:flex><span>print(paths);
</span></span></code></pre></td></tr></table></div></div><p>Although,</p><ol><li>Not just <code>std::vector</code>, but any container</li><li>Not just <code>std::filesystem::path</code>, but anything that can be converted to it</li></ol><p>One could go with the fully unconstrained version:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// or also
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>But it is strongly discouraged. This form is easy to misuse with invalid inputs, for which compilers would give terrible error messages. One bakes in some assumptions which are not explicitly stated in the function declaration, and likely requires extensive additional documentation to specify its terms of use.</p><p>Furthermore, it is always better first to constrain as much as possible, and release as per need, to avoid user reliance on something that would need to be limited afterwards.</p><h2 id=the-constraint>The constraint&mldr;</h2><p>Every container in the standard library (and followed by everyone in general) provides a dependent type name indicating the type of its elements: <a href=https://en.cppreference.com/w/cpp/container/vector#Member_types>value_type</a>. It is a <a href=https://stackoverflow.com/a/43064225>vital piece</a> for the development of generic algorithms. We want our new function to be usable by any container (which follows the standard recommendations). Thus, here is a possible constraint on our template parameter:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type, std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>However, <code>T</code> can be deduced to a reference and the like, which do not allow for evaluating dependent name.</p><blockquote><pre tabindex=0><code>❌ error: &#39;std::vector&lt;std::filesystem::__cxx11::path&gt;&amp;&#39; is not a class, struct, or union type
</code></pre></blockquote><p>That&rsquo;s why it is often necessary to peel the template parameters with the help of some type traits, e.g. <a href=https://en.cppreference.com/w/cpp/types/decay><code>std::decay_t</code></a> or <a href=https://en.cppreference.com/w/cpp/types/remove_cvref><code>std::remove_cvref_t</code></a></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=using-sfinae>&mldr;using SFINAE</h2><p><em>Substitution failure is not an error</em> (<a href=https://en.cppreference.com/w/cpp/language/sfinae>SFINAE</a>) <del>is</del> was one of the generic technique commonly used to constrain an overload set. Tag dispatch is another main alternative, often more explicit but less concise (and adds clutter); it will be skipped for the sake of brevity. SFINAE is already widely described online so I will not linger on it<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// SFINAE.A
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;*</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>nullptr</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>The position of the constraint can vary, but I usually prefer to keep it within the template argument list. Note that alternative versions:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6272a4>// SFINAE.B
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>typename</span> <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// SINFAE.C
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>,<span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// SINFAE.D
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths) <span style=color:#ff79c6>-&gt;</span> std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>,<span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>are all valid. Although <em>SFINAE.B</em> has the subtle disadvantage, but a major one, to prevent several definition containing <code>enable_if</code> because default type template parameters do not get mangled into the final function signature generated by the compiler. The compiler would then generate an error for the following examples:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6272a4>// SFINAE.B.1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>typename</span> <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6272a4>// SFINAE.B.2
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T, <span style=color:#ff79c6>typename</span> <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>enable_if_t<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_array_v<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>❌ <span style=color:#8be9fd;font-style:italic>error</span>: redefinition of &#39;<span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span>, <span style=color:#ff79c6>class</span><span style=color:#ff79c6>&gt;</span> <span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span>)&#39;
</span></span></code></pre></td></tr></table></div></div></blockquote><h2 id=using-constant-expression>&mldr;using constant expression</h2><p>SFINAE (and tag dispatch) were the main (and only?) way to handle such scenario until the introduction of <a href=https://en.cppreference.com/w/cpp/language/if#Constexpr_if><code>if constexpr</code></a> in C++17 (and concepts in C++20). This new option allows the compiler to select a conditional branch at compile-time.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#50fa7b>constexpr</span>(std<span style=color:#ff79c6>::</span>is_same_v<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>    	<span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>            print(path);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>It is definitely more readable than SFINAE since it reads like the good ol&rsquo; code (if/else) we are used to read. The issue with this technique for me, although my opinion might change with further experience with it, is:</p><ol><li>The signature is unhelpful to the reader, because catch-all template, unless specified in the comments or going through the definition</li><li>The definition becomes similar to a big <code>switch</code> whose size can become unwieldy and I prefer the clarity of multiple declarations</li><li>Wrong branch selection might be harder to detect or too easy to occur</li></ol><h2 id=using-concepts>&mldr;using concepts</h2><p>A new big thing in C++20 is the <a href=https://en.cppreference.com/w/cpp/language/constraints>concepts</a>, which is a clean and efficient way to impose constraints or describe interfaces when diving into generic programming. The constraints can be imposed either by defining concepts or by introducing ad-hoc constraints with the keyword <code>requires</code>. Note that the type trait <code>is_same</code>/<code>is_same_v</code> is symmetric to the concept <code>same_as</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=the-satisfaction-of-a-job-done>The satisfaction of a job done</h2><p>Putting everything together gives a brief, yet powerful, interface.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;filesystem&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;vector&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;set&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;type_traits&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> path)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\t</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> path <span style=color:#ff79c6>&lt;&lt;</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value_type,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Path</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> path_a <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path(<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>);
</span></span><span style=display:flex><span>    print(path_a);
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;String</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> string_a <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>string(<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>);
</span></span><span style=display:flex><span>    print(string_a);
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Vector</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> paths_a <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>{<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>, <span style=color:#f1fa8c>&#34;bar/foo&#34;</span>};
</span></span><span style=display:flex><span>    print(paths_a);
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Set</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> paths_b <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>set<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>{<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>, <span style=color:#f1fa8c>&#34;bar/foo&#34;</span>};
</span></span><span style=display:flex><span>    print(paths_b);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Output</strong></p><pre tabindex=0><code>Path
	&#34;foo/bar&#34;
String
	&#34;foo/bar&#34;
Vector
	&#34;foo/bar&#34;
	&#34;bar/foo&#34;
Set
	&#34;bar/foo&#34;
	&#34;foo/bar&#34;
</code></pre></blockquote><p>Yey ! Job done, let&rsquo;s go home&mldr; or?</p><h2 id=all-is-ephemeral>All is ephemeral</h2><p>It came up quickly &mdash; ahem, during the first reality check &mdash; that several major use-cases were missing.</p><ol><li>Using the function with container of string-like objects<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>&gt;</span> paths;
</span></span><span style=display:flex><span>print(paths);
</span></span></code></pre></td></tr></table></div></div></li><li>Using the function with <code>std::ranges</code>, for example, by prepending a path<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span> paths;
</span></span><span style=display:flex><span><span style=color:#ff79c6>auto</span> prepend_with <span style=color:#ff79c6>=</span> [](<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;&amp;</span> x) {<span style=color:#ff79c6>return</span> [<span style=color:#ff79c6>&amp;</span>x](<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;&amp;</span>p){<span style=color:#ff79c6>return</span> x<span style=color:#ff79c6>/</span>p;};};
</span></span><span style=display:flex><span>print(paths <span style=color:#ff79c6>|</span> std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>views<span style=color:#ff79c6>::</span>transform(prepend_with(<span style=color:#f1fa8c>&#34;blop&#34;</span>)));
</span></span></code></pre></td></tr></table></div></div></li><li>Using the function with brace-enclosed initializer lists of <code>std::filesystem::path</code> or string-like values<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>print({path1, path2});
</span></span><span style=display:flex><span>print({<span style=color:#f1fa8c>&#34;foo/bar&#34;</span>,<span style=color:#f1fa8c>&#34;bar/foo&#34;</span>});
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=expanding-the-interface>Expanding the interface</h2><p>Resolving the first issue is relatively simple. In essence, we need to accept any object that can be converted to a <code>std::filesystem::path</code>. Fortunately, the C++ standard provides several <a href=https://en.cppreference.com/w/cpp/concepts#Core_language_concepts>core concepts</a>, which includes one with the exact name corresponding to our interpretation <a href=https://en.cppreference.com/w/cpp/concepts/convertible_to><code>std::convertible_to</code></a>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value_type, std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(T<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p>📝 Note that the concept <a href=https://en.cppreference.com/w/cpp/concepts/constructible_from><code>std::constructible_from</code></a> is also applicable, and which might be more favorable in some (corner?) cases. More on this topic: <a href=https://akrzemi1.wordpress.com/2016/08/24/is-constructible/>Is constructible?</a> and <a href=https://stackoverflow.com/a/76547623>std::convertible_to failing to recognize explicitly convertible types</a></p></blockquote><p>Dealing with ranges elegantly resolves the case for containers too, because a range generalize iteration of containers, they just need to provide an iterator pair <code>begin</code> and <code>end</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(R<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>However, it becomes again under-constrained because the type of an element of the range is unspecified. The container-specific dependent type <code>value_type</code> cannot be reused as such because the <code>std::ranges</code> library defines its own <a href=https://en.cppreference.com/w/cpp/ranges#Range_primitives>set of &ldquo;dependent&rdquo; types</a>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(R<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Initializer lists, more commonly faced as anonymous brace-enclosed initializer lists, require a separate codepath. Due to their anonymous nature, they do not behave similarly as a concrete container and cannot be deduced directly through a templated function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> foo(T) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>foo({<span style=color:#bd93f9>0</span>,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>2</span>});
</span></span><span style=display:flex><span><span style=color:#6272a4>// What type should deduced for T with {0,1,2} ? 
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// There is simply not enough information for the compiler to decide.
</span></span></span></code></pre></td></tr></table></div></div><p>Brace-enclosed initializer lists are abstract entities that try to conform to the target type, which does not exist when using template arguments because the target type can be anything. Hence the need for a specific overload of the function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(std<span style=color:#ff79c6>::</span>initializer_list<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>I will not go into the topic of <code>initializer_list</code> nor concept subsumption or overload resolution in this post for the sake of keeping this piece as a blog post and not turning it into a book 😄</p><h2 id=lets-roll->Let&rsquo;s roll !</h2><p>Running the following example on <a href=https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1DIApACYAQuYukl9ZATwDKjdAGFUtAK4sGIM6SuADJ4DJgAcj4ARpjEIADMXKQADqgKhE4MHt6%2B/ilpGQIhYZEsMXGJtpj2jgJCBEzEBNk%2BfgF2mA6Z9Y0ExRHRsQlJCg1NLbntY32hA2VDiQCUtqhexMjsHObxocjeWADUJvFuaAwbyQQKx9gmGgCC27v7mEcnNPQKAJ6jmCw3d0eZh25xebzcoQyYjwAC9YgB9Wh4UYAh5PUFeQ7HCFpAjETCsVFAkF7TGvbHEQzATDXeK3NEPLzpIwHUboEAgD40n4EP4c5JMAgIY5WBn3ABuqDw6AOyWIoQIEAFQoOZxRZgAbLLBQhFoCTAB2UX3A6m1kEdkoVYEcHY7VCgB0o3lRggi1tJ3MZhMAFY3AwvSL9QaACL6h68ljJAy87FsjmUow0hNU14AJRuB3xAEcvHh8QpzZazuLYo4ovR4UQ4xaU0mFHXqfDxWIvJgq9iM3TbLXOXRub8WPydUTJdLZS7FRnNeYtcqEAo9WijYCzQd%2BMQIEwvERVQJ1XOdQcQPaF0uTWuzXKFUqdXr4sbDWGxZHo4LMNiCF9koxWK8ACqZjmeYFkWHIlmWeAVu21YnPGID4iwqClvCyDiviVAdicgHdvBXLfIOw5CqOUoyteggQPBkKONCcLEIiyIENiOHYKei7Bsaa4bluO6oHuDAHqex5seel5XpOt5Cvej6huG9wKgcLBMKEbocau4k3vOhpWGYZgOgA9PwqD6VEjSBqG0nBiGHDLLQnA%2BrwfgcFopCoJwbjWNYrKrOs5LAjwpAEJoNnLAA1iAPoaPonCSLwQ5cBoUVOS5bkcLwDZRUFzk2aQcCwDAiBWlG/ZkBQEBoMV9BxMAXDxAEHy8sQDYQFEwWkFEoSNF8nABR1zDEF8ADyUTaJ0WUBRVbCCINDC0N12WkFgUReMAbhiLQDbcLwWBKUY4gLfg%2BJdKWm0uZgqidDumwuQq1RtUiUSUgNHhYG1eJ4EOW3LFQBjAAoABqeCYAA7oNP5OQF/CCCIYjsFIMiCIoKjqAtuhJAYRgoJ5lj6FBDaQMsqCXJkm0ALRsscIamJY1hmClpbEPKWD426VQ1JkLgMO4nitHowSzKU5R6Kk6S1FkPO5EkIuFAw/SC0MIzVGN3TTBMfiK%2BzdTTHLgxxCMqsS%2BrPa9Dr8x68sCg%2BRsEi2fZjltalByqAAHBqpMapIBzAMgyAHLVDpmAcEC4IQJBHP5iy8FlWiLGFEVRXZHCxaQQ6RaQyW8Kl6UgJlwXLHlhXWskO7kJQFXJCV4R/pwLtux7Xs%2B378QB7wmD4EQTN6FDwiiOI8Pd0jahtWjpDA5SyQ9TlicOenDucINO7FzaqBUE7rvu573u%2B/7gcQB4lWxOHSxR3nywIASWBxKzifJ6nSVz2ltg54Fp%2BkOFaeJ/E9sLVnL/ZbH0UOBmG/ilTgJ9/7LAZukZwkggA%3D%3D>Compiler Explorer</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;concepts&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;filesystem&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;initializer_list&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;ranges&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> path)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> path.string() <span style=color:#ff79c6>&lt;&lt;</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(R<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(std<span style=color:#ff79c6>::</span>initializer_list<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    print(path{<span style=color:#f1fa8c>&#34;./foo/bar&#34;</span>});
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Output</strong></p><pre tabindex=0><code class=language-🖹 data-lang=🖹>.
foo
bar
</code></pre></blockquote><p>Huh?! Where is the nice printed one-liner <code>./foo/bar</code> 😠</p><h2 id=tell-me-why-musical_note>Tell me why 🎵</h2><p>Instead of the desired output</p><blockquote><p>./foo/bar</p></blockquote><p>We got our path sliced like a salami</p><blockquote><p>.
foo
bar</p></blockquote><p>Sometimes programming is like medicine, let us proceed with the diagnosis.</p><h3 id=symptom-template-overload-priority>Symptom: template overload priority</h3><p>Consider the following function call:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>print(fs<span style=color:#ff79c6>::</span>path{<span style=color:#f1fa8c>&#34;./foo/bar&#34;</span>});<span style=color:#6272a4>// matches more closely print(fs::path&amp;&amp;) or print(path) rather than print(fs::path const&amp;)
</span></span></span></code></pre></td></tr></table></div></div><p>It involves a temporary <code>std::filesystem::path</code>, which is a pure rvalue. When the compiler sees the call <code>print(fs::path{"./foo/bar"})</code>, it chooses the most specialized template that can match the argument, or emit an &ldquo;ambiguous&rdquo; compiler error if several candidates match equivalently.</p><p>The <code>print(fs::path const& path)</code> specialization is not an exact match for either a mutable lvalue, nor an rvalue argument. Even if it is a function overload rather than a template specialization, there is no priority for such within the <a href=https://en.cppreference.com/w/cpp/language/overload_resolution#Additional_rules_for_function_template_candidates>selection process</a>.</p><p>The template version, even if constrained, can accept both lvalues and rvalues due to its parameter parameter being a forwarding reference (<code>R&&</code>). In our example, since our input is an rvalue, the compiler considers this version to be a better match for the rvalue argument and pick it instead of the concrete overload.</p><p>To resolve this issue and ensure that the right version is called, one can provide an overload specifically for rvalues:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(fs<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&amp;&amp;</span> path)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> path.string() <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>With this overload, the compiler will now prefer the <code>print(fs::path&& path)</code> version when an rvalue is passed.</p><p>Note that a similar symptom would have been triggered if we were to use a forwarding reference within the range-for loop of the constrained template function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>template&lt;range R&gt; requires std::convertible_to&lt;range_value_t&lt;R&gt;,path&gt;
</span></span><span style=display:flex><span>void print(R&amp;&amp; paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#f55>-    for(auto const&amp;  path : paths)
</span></span></span><span style=display:flex><span><span style=color:#f55>-        print(path);
</span></span></span><span style=display:flex><span><span style=color:#f55></span><span style=color:#50fa7b;font-weight:700>+    for(auto&amp;&amp; path : paths)
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+        print(path);
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700></span>}
</span></span></code></pre></td></tr></table></div></div><p>Hereby requiring us to slap the final overload for mutable lvalue <code>print(fs::path& path)</code>.</p><p>Unfortunately, it introduces quite some boilerplate, obfuscating the root cause of the problem we face.</p><h3 id=cause-abbr-titlestdfilesystempathpathhttpsencppreferencecomwcppfilesystempathabbr-satisfies-the-concept-abbr-titlestdrangesrangerangehttpsencppreferencecomwcpprangesrangeabbr-itself>Cause: <abbr title=std::filesystem::path><a href=https://en.cppreference.com/w/cpp/filesystem/path><code>path</code></a></abbr> satisfies the concept <abbr title=std::ranges::range><a href=https://en.cppreference.com/w/cpp/ranges/range><code>range</code></a></abbr> itself.</h3><p>Concepts in C++20 are <a href=https://www.foonathan.net/2021/07/concepts-structural-nominal/>structural</a>. Any concept created outside the developer&rsquo;s control can apply to any type as long as the apparent constraints are fulfilled, whether or not they want it or mean it <em>semantically</em>.</p><blockquote><p>📝 Even though C++ Core Guidelines recommend to have concepts modeling semantic notions rather than syntactic one, it is effectively hard to avoid.</p><blockquote><p>The intent of concepts is to model semantic categories (Number, Range, RegularFunction) rather than syntactic restrictions (HasPlus, Array). According to <a href=https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#t20-avoid-concepts-without-meaningful-semantics>ISO C++ core guideline T.20</a>, &ldquo;The ability to specify meaningful semantics is a defining characteristic of a true concept, as opposed to a syntactic constraint.&rdquo; &mdash; <a href=https://en.cppreference.com/w/cpp/language/constraints>https://en.cppreference.com/w/cpp/language/constraints</a></p></blockquote></blockquote><p>An example of something that looks like a range but is not:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>this_is_not_a_range_and_yet</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> <span style=color:#50fa7b>begin</span>() { <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;this is only the beginning&#34;</span>;};
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>auto</span> <span style=color:#50fa7b>end</span>()   { <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;this is already the end&#34;</span>;};
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>static_assert</span>(std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range<span style=color:#ff79c6>&lt;</span>this_is_not_a_range_and_yet<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>false</span>);
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>Compiler</strong></p><pre tabindex=0><code>error: static assertion failed
43 | static_assert(std::ranges::range&lt;this_is_not_a_range_and_yet&gt; == false);
      |                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~
note: the comparison reduces to &#39;(1 == 0)&#39;
</code></pre></blockquote><p>😐😐😐</p><p>When looking closer at the C++ standard, the <em>range</em> concept is defined in a simple way:</p><blockquote><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>T</span> <span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>concept</span> range <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>requires</span>( T<span style=color:#ff79c6>&amp;</span> t ) {
</span></span><span style=display:flex><span>	ranges<span style=color:#ff79c6>::</span>begin(t); <span style=color:#6272a4>// equality-preserving for forward iterators
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>	ranges<span style=color:#ff79c6>::</span>end(t);
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>A typical range class only needs to provide two functions:</p><ol><li>A member function begin() whose return type models input_or_output_iterator.</li><li>A member function end() whose return type models sentinel_for<it>, where It is the return type of begin().</li></ol><p>Alternatively, they can be non-member functions, to be found by argument-dependent lookup.</p><p>&mdash; <a href=https://www.iso.org/standard/79358.html><em>ISO/IEC 14882:2020 (C++20)</em></a></p></blockquote><p>Every type that provides the couple <code>begin()</code> and <code>end()</code> member functions with some compatible return type (for example a <code>T*</code>) will be considered as a range. <a href=https://en.cppreference.com/w/cpp/filesystem/path><code>std::filesystem::path</code></a> does provide those functions, which enables to traverse each node of the path, i.e. pieces located between path separator pairs. Therefore <a href=https://en.cppreference.com/w/cpp/filesystem/path><code>std::filesystem::path</code></a> represents a <a href=https://en.cppreference.com/w/cpp/ranges/range><code>range</code></a>.</p><p>The better treatment, compared to the rvalue overload mentioned above, is to change the constraint itself to restrict further the space of acceptable types, by skipping the overload when the type for range R is convertible to a path:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span>std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>R,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span> <span style=color:#6272a4>//! addition to the previous version
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> print(R<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=final-snippet>Final snippet</h2><p>With all of this in mind or resolved, we can get to our final snippet 🎉</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;concepts&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;filesystem&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;initializer_list&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;ranges&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>print</span>(std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> path)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> path.string() <span style=color:#ff79c6>&lt;&lt;</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range R<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>ranges<span style=color:#ff79c6>::</span>range_value_t<span style=color:#ff79c6>&lt;</span>R<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span>std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>R,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(R<span style=color:#ff79c6>&amp;&amp;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>template</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>remove_cvref_t<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>,std<span style=color:#ff79c6>::</span>filesystem<span style=color:#ff79c6>::</span>path<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> print(std<span style=color:#ff79c6>::</span>initializer_list<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> paths)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(<span style=color:#ff79c6>auto</span> <span style=color:#ff79c6>const</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>path</span> : paths)
</span></span><span style=display:flex><span>        print(path);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion</h2><p>All this thought process for producing a few line of code 😔 But see the power in those lines ! Though, I would have wished that <code>std::filesystem::path</code> was not implicitly a range, as well as <code>std::string</code>, for example by asking us to opt-in with a <code>as_range()</code> member or free function.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://en.cppreference.com/w/cpp/language/sfinae#SFINAE_in_partial_specializations>https://en.cppreference.com/w/cpp/language/sfinae#SFINAE_in_partial_specializations</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://www.cppstories.com/2016/02/notes-on-c-sfinae/>https://www.cppstories.com/2016/02/notes-on-c-sfinae/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></main><footer id=footer><div id=footer-inner>&copy;&nbsp;2020-2025&nbsp;&#183;&nbsp;Fabien Péan</div></footer><script>window.FontAwesomeConfig={searchPseudoElements:!0}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js integrity="sha512-EBLzUL8XLl+va/zAsmXwS7Z2B1F9HUHkZwyS/VKwh3S7T/U0nF4BaU29EP/ZSf6zgiIxYAnKLu6bJ8dqpmX5uw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.3.0/mermaid.min.js integrity="sha512-iNz/jLoA4NrS3LUPX4xNM1x1MaIspYCwoMgOn69bE7vpHGNJ/TjM2+RdQneJrKWoTv+YtHdynXG9MqJmqBOS8g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose",theme:"default",themeCSS:"",cloneCssStyles:!0,useMaxWidth:!0,htmlLabels:!1,flowchart:{curve:"basis"}})</script><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!1,processEnvironments:!0,tags:"ams"},svg:{fontCache:"global",displayAlign:"left",displayIndent:"2emem"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js integrity="sha512-6FaAxxHuKuzaGHWnV00ftWqP3luSBRSopnNAA2RvQH1fOfnF/A1wOfiUWF7cLIOFcfb1dEhXwo5VG3DAisocRw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=/js/custom.js></script></body></html>